---

- name: Wait for all nodes to be ready
  ansible.builtin.command: >
    kubectl wait --for=condition=Ready node --all --timeout=10m
  environment:
    KUBECONFIG: "{{ kubeconfig_path }}"
  changed_when: false
  tags: verify

- name: Get cluster nodes status
  ansible.builtin.command: kubectl get nodes -o wide
  environment:
    KUBECONFIG: "{{ kubeconfig_path }}"
  register: k8s_verify_cluster_nodes
  changed_when: false
  tags: verify

- name: Get all cluster resources
  ansible.builtin.command: kubectl get all -A
  environment:
    KUBECONFIG: "{{ kubeconfig_path }}"
  register: k8s_verify_cluster_resources
  changed_when: false
  tags: verify

- name: Display final verification status
  ansible.builtin.debug:
    msg:
      - "âœ“ Kubernetes cluster is fully operational"
      - "{{ k8s_verify_cluster_nodes.stdout_lines }}"
  tags: verify
